| dbxquery
maxrows=250000
connection="ngp_connection"
timeout=1800 query="
SELECT   'join' as myjoin,
         COUNT(guid) as enum_pg_calls
FROM     master.flowstart a
WHERE    extract('epoch' from to_timestamp(a.analyticstime/1000) at time zone 'cst6cdt') * 1000 >= (extract (epoch from (now() at time zone 'cst6cdt')::date - interval '1 day') * 1000)::bigint AND
         extract('epoch' from to_timestamp(a.analyticstime/1000) at time zone 'cst6cdt') * 1000  < (extract (epoch from (now() at time zone 'cst6cdt')::date) * 1000)::bigint AND
         routername LIKE 'enum%'
" shortnames=t
| join type=left myjoin [
search index="policyguru_data" resourceId="enum*" NOT disposition.disposition="*" earliest=-1d@d latest=-0d@d
| stats count as enum_ads_calls
| eval myjoin="join"
]
| eval diff=enum_pg_calls-enum_ads_calls
| eval perc_diff=ROUND((diff/enum_pg_calls)*100,2)
| table enum_pg_calls enum_ads_calls diff perc_diff
| search perc_diff > 5
